<div class="card grid grid-flow-row-dense sm:grid-cols-1 md:grid-cols-3 gap-4">
    <div class="md:col-span-3 flex items-center justify-between flex-wrap gap-2">
        <div class="flex items-center gap-2">
            <i class="pi pi-wrench text-2xl"></i>
            <span class="text-xl font-semibold">Solución Transacción</span>
        </div>
        <p-tag [styleClass]="dataTrxObservada.estado === '01' ? 'p-tag-danger' : 'p-tag-success'"
            [value]="dataTrxObservada.descripcionEstado"></p-tag>
    </div>

    <div class="md:col-span-3 grid grid-flow-row-dense sm:grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-1">
            <span class="font-bold">ID Trans. Observada:</span>
            <span class="secondary-text">{{dataTrxObservada.id}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">ID Transacción:</span>
            <span class="secondary-text">{{dataTrxObservada.data.procesador?.transaccion?.idTransaccion}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Fecha Apertura:</span>
            <span class="secondary-text">{{dataTrxObservada.fechaCreacionConvert}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Fecha Transacción:</span>
            <span class="secondary-text">{{dataTrxObservada.data.entrada.MCTIFTRAConvert}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Monto:</span>
            <span class="secondary-text">{{dataTrxObservada.data.entrada.MCTIIMPOConvert}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Moneda:</span>
            <span class="secondary-text">{{dataTrxObservada.data.entrada.MCTIMONEDesc}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Nombre Comercio:</span>
            <span class="secondary-text">{{dataTrxObservada.data.entrada.MCTINEST}}</span>
        </div>
        <div class="md:col-span-1">
            <span class="font-bold">Origen:</span>
            <span class="secondary-text">{{dataTrxObservada.data.procesador?.transaccion?.descripcionOrigen}}</span>
        </div>
        <div class="md:col-span-3">
            <span class="font-bold">Motivo:</span>
            <span class="secondary-text">{{dataTrxObservada.motivoEstado}}</span>
        </div>
        <p-divider class="md:col-span-3" />
    </div>

    <div class="md:col-span-3">
        <form [formGroup]="formSolucionTransaccion" class="grid grid-flow-row-dense sm:grid-cols-1 md:grid-cols-2 gap-4"
            novalidate>
            <div class="md:col-span-1">
                <label for="tipoSolucion" class="block mb-1 text-sm">Tipo de Solución</label>
                <p-autoComplete id="tipoSolucion" formControlName="tipoSolucion" [suggestions]="filteredElementTipoSolucion"
                    (completeMethod)="filterElementTipoSolucion($event, tipoSoluciones)"
                    (ngModelChange)="changeModelTipoSolucion($event)" optionLabel="desElemento"
                    emptyMessage="Sin resultados" [dropdown]="true" appendTo="body" styleClass="w-full">
                    <ng-template let-element>
                        <div>{{element.desElemento}}</div>
                    </ng-template>
                </p-autoComplete>
            </div>
            <div class="md:col-span-1" *ngIf="formSolucionTransaccion?.value.tipoSolucion?.valCadCorto === '06'">
                <label for="" class="block mb-1 text-sm">Rango de Fechas</label>
                <p-datepicker formControlName="fechaRangoAutorizaciones"
                    (ngModelChange)="changeModelFechaRangoAutorizaciones($event)" dateFormat="dd/mm/yy"
                    yearRange="1940:2030" selectionMode="range"                   
                    appendTo="body" styleClass="w-full"></p-datepicker>
            </div>
        </form>
    </div>

    <p-divider class="md:col-span-3" *ngIf="datosAutorizaciones.length > 0" />

    <div class="md:col-span-3" *ngIf="datosAutorizaciones.length > 0">
        <div class="flex items-center gap-2 mb-2">
            <i class="pi pi-check-circle text-lg"></i>
            <span class="font-semibold text-lg">Autorizaciones</span>
        </div>

        <p-table #dt1 resizableColumns="true" rowExpandMode="single" 
            class="mi-tabla-personalizada"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros" [paginator]="true"
            [showCurrentPageReport]="false" [filterDelay]="0" dataKey="idTransaccion" [first]="first" [rows]="rows"
            [value]="datosAutorizaciones" [totalRecords]="datosAutorizaciones.length" [reorderableColumns]="true"
            [resizableColumns]="true" columnResizeMode="expand" (onRowSelect)="onRowSelect($event)"
            (onRowUnselect)="onRowUnselect()" selectionMode="single" dataKey="idTransaccion"
            [(selection)]="selected">
            <ng-template pTemplate="header">
                <tr>
                    <th scope="col" pReorderableColumn pResizableColumn>Id Transacción</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Fecha Transacción</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Fecha Proceso</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Cod. Descripción</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Descripción</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Referencia</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Código Autorización</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Importe</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Red (descripción)</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Estado Confirmación</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Estado Autorización</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Reversado</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Cod. Rechazo</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Num. Tarjeta</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Token</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Id Transacción Original</th>
                    <th scope="col" pReorderableColumn pResizableColumn>Razón Estado</th>
                </tr>
                <tr id="tableWithIcon">
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'idTransaccion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'fechaTransaccion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'fechaConfirmacion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'transaccionResponse.ftcCode', 'startsWith')"
                            placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'transaccionResponse.ftcDescription', 'startsWith')"
                            placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'referencia', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'codigoAutorizacion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'transaccionProcesada.monto', 'startsWith')"
                            placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'descOrigenInt', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'estadoConfirmacion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'estadoAutorizacion', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'estadoReversado', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'codigoRechazo', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'tarjeta.enmascarado', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'tarjeta.token', 'startsWith')" placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'transaccionResponse.financialTransaction.parentTransactionId', 'startsWith')"
                            placeholder="">
                    </th>
                    <th scope="col">
                        <input pInputText type="text"
                            (input)="dt1.filter($event.target.value, 'motivoTransaccion', 'startsWith')" placeholder="">
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData>
                <tr id="tableWithDetails" [pSelectableRow]="rowData">
                    <td>{{rowData.idTransaccion}}</td>
                    <td>{{rowData.fechaTransaccion}}</td>
                    <td>{{rowData.fechaConfirmacion}}</td>
                    <td>{{rowData.transaccionResponse.ftcCode}}</td>
                    <td>{{rowData.transaccionResponse.ftcDescription}}</td>
                    <td>{{rowData.referencia}}</td>
                    <td>{{rowData.codigoAutorizacion}}</td>
                    <td>{{rowData.transaccionProcesada.monto | currency:"&nbsp;":"symbol":'1.2-2'}}</td>
                    <td>{{rowData.descOrigenInt}}</td>
                    <td>
                        <div *ngIf="rowData.estadoAutorizacion === 'REJECTED'; else estadoConfirmacion">
                            <span></span>
                        </div>
                        <ng-template #estadoConfirmacion>
                            <div [ngSwitch]="rowData.estadoConfirmacion">
                                <span *ngSwitchCase="'CONFIRMED'" class="p-tag p-tag-success"
                                    style="font-size: 12px;">{{rowData.estadoConfirmacion}}</span>
                                <span *ngSwitchCase="'PENDING'" class="p-tag p-tag-warning"
                                    style="font-size: 12px;">{{rowData.estadoConfirmacion}}</span>
                                <span *ngSwitchDefault class="p-tag p-tag-danger"
                                    style="font-size: 12px;">{{rowData.estadoConfirmacion}}</span>
                            </div>
                        </ng-template>
                    </td>
                    <td>
                        <div [ngSwitch]="rowData.estadoAutorizacion">
                            <span *ngSwitchCase="'AUTHORIZED'" class="p-tag p-tag-success"
                                style="font-size: 12px;">{{rowData.estadoAutorizacion}}</span>
                            <span *ngSwitchCase="'REJECTED'" class="p-tag p-tag-danger"
                                style="font-size: 12px;">{{rowData.estadoAutorizacion}}</span>
                            <span *ngSwitchCase="'REVERSED'" class="p-tag p-tag-danger"
                                style="font-size: 12px;">{{rowData.estadoAutorizacion}}</span>
                            <span *ngSwitchDefault class="p-tag p-tag-danger"
                                style="font-size: 12px;">{{rowData.estadoAutorizacion}}</span>
                        </div>
                    </td>
                    <td>{{rowData.estadoReversado}}</td>
                    <td>{{rowData.codigoRechazo}}</td>
                    <td>{{rowData.tarjeta.enmascarado}}</td>
                    <td>{{rowData.tarjeta.token}}</td>
                    <td>{{rowData.transaccionResponse.financialTransaction.parentTransactionId}}</td>
                    <td>{{rowData.motivoTransaccion}}</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="17" style="text-align:left">Sin registros encontrados</td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <div class="md:col-span-3 flex items-end justify-end gap-2 footer-modal">
        <button type="button" pButton label="Actualizar" icon="pi pi-refresh"
            [disabled]="formSolucionTransaccion.invalid" (click)="openDialogActualizacionSolucion()"></button>
        <button type="button" pButton label="Cerrar" icon="pi pi-times" class="p-button-outlined"
            (click)="dialogRef.close()"></button>
    </div>
</div>
